<!--下拉框3.0   二级联动下拉框,如二级不存在隐藏-->
<div class="form-group">
    <div class="layui-form-item">
        <label class="col-sm-2 control-label">分类:</label>
        <div class="col-md-6 col-sm-10" style="z-index: 2000!important;">
            <div class="layui-inline">
                <if condition="!empty($class_id)">
                    <select class="form-control post-params class_id" lay-filter="class_id" lay-search name="class_id">
                        <foreach item="vo" key="key" name="class_list">
                            <option value="{$vo.id}"
                            <if condition="$class_id eq $vo.id ">selected</if>
                            >{$vo.name}</option>
                        </foreach>
                    </select>
                    <else/>
                    <select class="form-control post-params" lay-filter="class_id" lay-search name="class_id">
                        <foreach item="vo" key="key" name="class_list">
                            <option value="{$vo.id}">{$vo.name}</option>
                        </foreach>
                    </select>
                </if>
            </div>

            <div class="layui-inline">
                <select class="form-control post-params second_class" lay-search name="second_class_id">
                </select>
            </div>


        </div>
    </div>

    <!--    上级id 和编辑id-->
    <!--   后台代码

        字段:
        second_class_id :二级分类id
        class_id :分类id
        search_class_id :用于搜索

       public function get_class_list()
       {
        $params = $this->request->param();
        $parent_id = $ShopGoodsClassModel->where('parent_id','=',0)->order('list_order,id desc')->value('id');//默认值
        if ($params['class_id']) $parent_id = $params['class_id'];
        $where   = [];
        $where[] = ['parent_id', '=', $parent_id];
        //查询信息
        $two_info   = $CourseModel->where('id', '=', $params['id'])->find();
        $result = $CourseClassModel
            ->where($where)
            ->select()
            ->each(function ($item, $key) use ($two_info) {
                //如果详情中,分类存在,回显
                if ($two_info['second_class_id'] == $item['id']) $item['selected'] = 'selected';
                return $item;
            });
        if (empty(count($result))) $this->error('暂无数据!');
        $this->success("list", '', $result);
       }


       //find展示代码
         $one_info        = $PlayClassModel->where('id', '=', $item['class_id'])->find();
        $two_info = $PlayClassModel->where('id', '=', $item['second_class_id'])->find();
        if ($one_info) $item['class_name'] = $one_info['name'];
        if ($two_info) $item['class_name'] = $two_info['name'];
        if ($two_info && $one_info) $item['class_name'] = $one_info['name'] . ' - ' . $two_info['name'];


       //edit代码
        if ($params['class_id']) $params['search_class_id'] = $params['class_id'];
        if ($params['second_class_id']) $params['search_class_id'] = $params['second_class_id'];
       -->

    <input class="post-params" id="class_id" type="hidden" value="{$class_id|default=''}">
    <input class="post-params" id="second_class_id" type="hidden" value="{$second_class_id|default=''}">
    <input class="post-params" id="id" type="hidden" value="{$id|default=''}">
    <script>
        $(".second_class_id").hide();//默认隐藏二级分类

        //加载页面自动执行
        layui.use(['form', 'element'], function () {
            var form = layui.form,
                element = layui.element;

            var class_id = $("#class_id").val();//当前分类id
            var id = $("#id").val();

            $.ajax({
                url: "{:url('get_class_list')}",
                type: "GET",
                data: {
                    'class_id': class_id,
                    'id': id,
                },
                async: false,
                success: function (res) {
                    //console.log(res);
                    if (res.code == 1) {
                        $(".second_class_id").show();//二级分类展示
                        List = res.data;
                        var tmp = '<option value="">请选择</option>';
                        for (var i in List) {
                            // tmp += '<option value="' + List[i].name + '"   "selected=' + List[i].selected + '">' + List[i].name + '</option>';
                            tmp += '<option value="' + List[i].id + '"  ' + List[i].selected + '>' + List[i].name + '</option>';
                        }
                        $(".second_class").html(tmp);//赋值一级分类下拉选择
                    } else {
                        $(".second_class_id").hide();//没有二级分类隐藏
                        $("#second_class_id").val(0);//二级分类赋值0
                    }

                    form.render('select');
                }
            });


            //一级选中执行
            form.on('select(class_id)', function (data) {
                console.log(data.elem); //得到select原始DOM对象
                console.log(data.value); //得到被选中的值
                $.ajax({
                    url: "{:url('get_class_list')}",
                    type: "GET",
                    data: {
                        'class_id': data.value
                    },
                    async: false,
                    success: function (res) {
                        if (res.code == 1) {
                            $(".second_class_id").show();//展示二级分类
                            List = res.data;
                            var tmp = '<option value="">请选择</option>';
                            for (var i in List) {
                                tmp += '<option value="' + List[i].id + '"  ' + List[i].selected + '>' + List[i].name + '</option>';
                            }
                            $(".second_class").html(tmp);//赋值一级分类下拉选择
                        } else {
                            $(".second_class_id").hide();//二级分类隐藏
                            $("#second_class_id").val(0);//二级分类赋值0
                        }
                        form.render('select');
                    }
                });
            });
        });
    </script>
</div>

<div class="form-group">
    <label class="col-sm-2 control-label">名称:</label>
    <div class="layui-input-block col-md-6 col-sm-10">
        <input class="form-control post-params item-left" name="name" type="text" value="{$name|default=''}">
    </div>
</div>
<div class="form-group">
    <label class="col-sm-2 control-label">价格:</label>
    <div class="layui-input-block col-md-6 col-sm-10">
        <input class="form-control post-params item-left" name="price" type="number" value="{$price|default=''}">
    </div>
</div>
<div class="form-group">
    <label class="col-sm-2 control-label">地图:</label>
    <div class="layui-input-block col-md-6 col-sm-10">
        <input class="form-control post-params item-left" name="map" type="text" value="{$map|default=''}">
    </div>
</div>


<div class="form-group layui-form-item" style="display: none;">
    <label class="col-sm-2 control-label">陪玩人数:</label>
    <div class="layui-input-block col-md-6 col-sm-10 layui-inline">
        <div class="layui-input-inline" style="width: 100px;">
            <input autocomplete="off" class="layui-input" lay-affix="number" max="3" min="1" name="number" placeholder=""
                   step="1" type="number" value="{$number|default='1'}">
        </div>
        <div class="layui-form-mid">-</div>
        <div class="layui-input-inline" style="width: 100px;">
            <input autocomplete="off" class="layui-input" lay-affix="number" max="3" min="1" name="number_max"
                   placeholder="" step="1" type="number" value="{$number_max|default='1'}">
        </div>
    </div>
</div>


<div class="form-group">
    <label class="col-sm-2 control-label">微信抽成比例(%):</label>
    <div class="layui-input-block col-md-6 col-sm-10">
        <input class="form-control post-params item-left" name="wx_platform_commission" type="number"
               value="{$wx_platform_commission|default=''}">
    </div>
</div>

<div class="form-group">
    <label class="col-sm-2 control-label">QQ抽成比例(%):</label>
    <div class="layui-input-block col-md-6 col-sm-10">
        <input class="form-control post-params item-left" name="qq_platform_commission" type="number"
               value="{$qq_platform_commission|default=''}">
    </div>
</div>
<div class="form-group">
    <label class="col-sm-2 control-label">虚拟数量:</label>
    <div class="layui-input-block col-md-6 col-sm-10">
        <input class="form-control post-params item-left" name="virtual_stock" type="number"
               value="{$virtual_stock|default=''}">
    </div>
</div>
<div class="form-group">
    <label class="col-sm-2 control-label">套餐介绍:</label>
    <div class="layui-input-block col-md-6 col-sm-10">
      <textarea class="form-control post-params item-left" cols="60" name="introduce"
                rows="4">{$introduce|default=''}</textarea>
    </div>
</div>
<div class="form-group">
    <label class="col-sm-2 control-label">封面:</label>
    <div class="layui-input-block col-md-6 col-sm-10">
        <input class="form-control post-params item-left" id="photo-0000006" name="image" type="hidden"
               value="{$image}">
        <if condition='!empty($image)'>
            <a href="javascript:imagePreviewDialog('{:cmf_get_asset_url($image)}');">
                <img id='photo-0000006-preview' src='{:cmf_get_image_preview_url($image)}'
                     style='width: 85px;height: 80px'>
            </a>
            <else/>
            <img id='photo-0000006-preview' src='/static/images/default.png' style='width: 85px;height: 80px'>
        </if>
        <a href="javascript:uploadOneImage('图片上传','#photo-0000006','image');">上传</a>
        <a onclick="$('#photo-0000006-preview').attr('src','__TMPL__/public/assets/images/default-thumbnail.png');$('#photo-0000006').val('');return false;">取消图片</a>
    </div>
</div>
<div class="form-group">
    <label class="col-sm-2 control-label">视频:</label>
    <div class="layui-input-block col-md-6 col-sm-10">
        <input class="form-control post-params item-left" id="file-video-0000007" name="video" readonly="readonly"
               type="text" value="{$video}">
        <if condition='!empty($video)'>
            <a href="{:cmf_get_file_download_url($video)}" id="file-video-0000007-preview"
               target="_blank">下载</a>
        </if>
        <a href="javascript:uploadOne('视频上传','#file-video-0000007','video');">上传</a>
    </div>
</div>

<div class="form-group">
    <label class="col-sm-2 control-label">详情图:</label>
    <div class="layui-input-block col-md-6 col-sm-10">
        <if condition="!empty($images)">
            <ul class="pic-list list-unstyled form-inline" id="photos-goods-0000001">
                <foreach item="vo" name="images">
                    <li id="saved-goods-image-0000001-{$key}" style="margin-bottom: 5px;">
                        <input id="photo-goods-0000001-{$key}" name="images[]" type="hidden" value="{$vo}">
                        <img id="photo-goods-0000001-{$key}-preview" onclick="parent.imagePreviewDialog(this.src);"
                             src="{:cmf_get_image_preview_url($vo)}" width="35">
                        <a href="javascript:uploadOneImage('图片上传','#photo-goods-0000001-{$key}');">替换</a>
                        <a href="javascript:(function(){$('#saved-goods-image-0000001-{$key}').remove();})();">移除</a>
                    </li>
                </foreach>
            </ul>
            <else/>
            <ul class="pic-list list-unstyled form-inline" id="photos-goods-0000001">
                <li id="saved-goods-image-0000001" style="margin-bottom: 5px;">
                </li>
            </ul>
        </if>
        <a class="btn btn-sm btn-default"
           href="javascript:uploadMultiImage('图片上传','#photos-goods-0000001','photos-goods-item-tpl-0000001');">选择图片</a>
        <script id="photos-goods-item-tpl-0000001" type="text/html">
            <li id="saved-goods-image-0000001-{id}" style="margin-bottom: 5px;">
                <input id="photo-goods-0000001-{id}" type="hidden" name="images[]" value="{filepath}">
                <img id="photo-goods-0000001-{id}-preview" src="{url}" width="35"
                     onclick="imagePreviewDialog(this.src);">
                <a href="javascript:uploadOneImage('图片上传','#photo-goods-0000001-{id}');">替换</a>
                <a href="javascript:(function(){$('#saved-goods-image-0000001-{id}').remove();})();">移除</a>
            </li>
        </script>
    </div>
</div>


<div class="form-group">
    <label class="col-sm-2 control-label">套餐详情:</label>
    <div class="layui-input-block col-md-6 col-sm-10">
        <script id="content" name="content" type="text/plain">
            {:cmf_replace_content_file_url(htmlspecialchars_decode($content))}



        </script>
        <script type="text/javascript">
            //编辑器路径定义
            var editorURL = GV.WEB_ROOT;
        </script>
        <script src="/static/js/ueditor/ueditor.config.js" type="text/javascript"></script>
        <script src="/static/js/ueditor/ueditor.all.min.js" type="text/javascript"></script>
        <script type="text/javascript">
            $(function () {
                editorcontent = new baidu.editor.ui.Editor();
                editorcontent.render('content');
                try {
                    editorcontent.sync();
                } catch (err) {
                }
            });
        </script>
    </div>
</div>


